!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t){NeuQuant=function(){var e,t,r,i,n,s={},a=256,o=499,c=491,l=487,u=503,h=3*u,f=a-1,m=4,d=100,y=16,w=1<<y,g=10,p=10,v=w>>p,F=w<<g-p,S=a>>3,b=6,B=1<<b,x=S*B,N=30,T=10,D=1<<T,C=8,P=1<<C,z=T+C,M=1<<z,A=[],k=[],E=[],I=[],O=s.NeuQuant=function(e,s,o){var c,l;for(t=e,r=s,i=o,n=new Array(a),c=0;c<a;c++)n[c]=new Array(4),(l=n[c])[0]=l[1]=l[2]=(c<<m+8)/a,E[c]=w/a,k[c]=0},L=function(){for(var e=[],t=new Array(a),r=0;r<a;r++)t[n[r][3]]=r;for(var i=0,s=0;s<a;s++){var o=t[s];e[i++]=n[o][0],e[i++]=n[o][1],e[i++]=n[o][2]}return e},X=function(){var e,t,r,i,s,o,c,l;for(c=0,l=0,e=0;e<a;e++){for(r=e,i=(s=n[e])[1],t=e+1;t<a;t++)(o=n[t])[1]<i&&(r=t,i=o[1]);if(o=n[r],e!=r&&(t=o[0],o[0]=s[0],s[0]=t,t=o[1],o[1]=s[1],s[1]=t,t=o[2],o[2]=s[2],s[2]=t,t=o[3],o[3]=s[3],s[3]=t),i!=c){for(A[c]=l+e>>1,t=c+1;t<i;t++)A[t]=e;c=i,l=e}}for(A[c]=l+f>>1,t=c+1;t<256;t++)A[t]=f},Y=function(){var n,s,a,f,y,w,g,p,v,F,S,B,T,C;for(r<h&&(i=1),e=30+(i-1)/3,B=t,T=0,C=r,F=(S=r/(3*i))/d|0,p=D,(g=(w=x)>>b)<=1&&(g=0),n=0;n<g;n++)I[n]=p*((g*g-n*n)*P/(g*g));for(v=r<h?3:r%o!=0?3*o:r%c!=0?3*c:r%l!=0?3*l:3*u,n=0;n<S;)if(a=(255&B[T+0])<<m,f=(255&B[T+1])<<m,y=(255&B[T+2])<<m,s=U(a,f,y),j(p,s,a,f,y),0!==g&&R(g,s,a,f,y),(T+=v)>=C&&(T-=r),0===F&&(F=1),++n%F==0)for(p-=p/e,(g=(w-=w/N)>>b)<=1&&(g=0),s=0;s<g;s++)I[s]=p*((g*g-s*s)*P/(g*g))},K=(s.map=function(e,t,r){var i,s,o,c,l,u,h;for(l=1e3,h=-1,s=(i=A[t])-1;i<a||s>=0;)i<a&&((o=(u=n[i])[1]-t)>=l?i=a:(i++,o<0&&(o=-o),(c=u[0]-e)<0&&(c=-c),(o+=c)<l&&((c=u[2]-r)<0&&(c=-c),(o+=c)<l&&(l=o,h=u[3])))),s>=0&&((o=t-(u=n[s])[1])>=l?s=-1:(s--,o<0&&(o=-o),(c=u[0]-e)<0&&(c=-c),(o+=c)<l&&((c=u[2]-r)<0&&(c=-c),(o+=c)<l&&(l=o,h=u[3]))));return h},s.process=function(){return Y(),K(),X(),L()},function(){var e;for(e=0;e<a;e++)n[e][0]>>=m,n[e][1]>>=m,n[e][2]>>=m,n[e][3]=e}),R=function(e,t,r,i,s){var o,c,l,u,h,f,m;for((l=t-e)<-1&&(l=-1),(u=t+e)>a&&(u=a),o=t+1,c=t-1,f=1;o<u||c>l;){if(h=I[f++],o<u){m=n[o++];try{m[0]-=h*(m[0]-r)/M,m[1]-=h*(m[1]-i)/M,m[2]-=h*(m[2]-s)/M}catch(e){}}if(c>l){m=n[c--];try{m[0]-=h*(m[0]-r)/M,m[1]-=h*(m[1]-i)/M,m[2]-=h*(m[2]-s)/M}catch(e){}}}},j=function(e,t,r,i,s){var a=n[t];a[0]-=e*(a[0]-r)/D,a[1]-=e*(a[1]-i)/D,a[2]-=e*(a[2]-s)/D},U=function(e,t,r){var i,s,o,c,l,u,h,f,d,w;for(d=f=~(1<<31),h=u=-1,i=0;i<a;i++)(s=(w=n[i])[0]-e)<0&&(s=-s),(o=w[1]-t)<0&&(o=-o),s+=o,(o=w[2]-r)<0&&(o=-o),(s+=o)<f&&(f=s,u=i),(c=s-(k[i]>>y-m))<d&&(d=c,h=i),l=E[i]>>p,E[i]-=l,k[i]+=l<<g;return E[u]+=v,k[u]-=F,h};return O.apply(this,arguments),s}},function(e,t){LZWEncoder=function(){var e,t,r,i,n,s,a,o,c,l,u,h,f={},m=-1,d=12,y=5003,w=d,g=1<<d,p=[],v=[],F=y,S=0,b=!1,B=0,x=0,N=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],T=[],D=f.LZWEncoder=function(n,s,a,o){e=n,t=s,r=a,i=Math.max(2,o)},C=function(e,t){T[h++]=e,h>=254&&A(t)},P=function(e){z(F),S=l+2,b=!0,I(l,e)},z=function(e){for(var t=0;t<e;++t)p[t]=-1},M=f.compress=function(e,t){var r,i,n,s,f,d,y;for(b=!1,o=k(a=c=e),u=(l=1<<e-1)+1,S=l+2,h=0,s=E(),y=0,r=F;r<65536;r*=2)++y;y=8-y,z(d=F),I(l,t);e:for(;(n=E())!=m;)if(r=(n<<w)+s,p[i=n<<y^s]!=r){if(p[i]>=0){f=d-i,0===i&&(f=1);do{if((i-=f)<0&&(i+=d),p[i]==r){s=v[i];continue e}}while(p[i]>=0)}I(s,t),s=n,S<g?(v[i]=S++,p[i]=r):P(t)}else s=v[i];I(s,t),I(u,t)},A=(f.encode=function(r){r.writeByte(i),n=e*t,s=0,M(i+1,r),r.writeByte(0)},function(e){h>0&&(e.writeByte(h),e.writeBytes(T,0,h),h=0)}),k=function(e){return(1<<e)-1},E=function(){return 0===n?m:(--n,255&r[s++])},I=function(e,t){for(B&=N[x],x>0?B|=e<<x:B=e,x+=a;x>=8;)C(255&B,t),B>>=8,x-=8;if((S>o||b)&&(b?(o=k(a=c),b=!1):(++a,o=a==w?g:k(a))),e==u){for(;x>0;)C(255&B,t),B>>=8,x-=8;A(t)}};return D.apply(this,arguments),f}},function(e,t){GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,i=0;i<r;i++)e+=t[this.bin[i]];return e},r.prototype.writeByte=function(e){this.bin.push(e)},r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))},r.prototype.writeBytes=function(e,t,r){for(var i=r||e.length,n=t||0;n<i;n++)this.writeByte(e[n])};var i,n,s,a,o,c,l,u,h,f={},m=null,d=-1,y=0,w=!1,g=[],p=7,v=-1,F=!1,S=!0,b=!1,B=10,x="Generated by jsgif (https://github.com/antimatter15/jsgif/)",N=(f.setDelay=function(e){y=Math.round(e/10)},f.setDispose=function(e){e>=0&&(v=e)},f.setRepeat=function(e){e>=0&&(d=e)},f.setTransparent=function(e){m=e},f.setComment=function(e){x=e},f.addFrame=function(e,t){if(null===e||!w||null===a)throw new Error("Please call start method before calling addFrame");var r=!0;try{t?e instanceof ImageData?(o=e.data,sizeset&&i==e.width&&n==e.height||T(e.width,e.height)):e instanceof Uint8ClampedArray?e.length==i*n*4?o=e:(console.log("Please set the correct size: ImageData length mismatch"),r=!1):(console.log("Please provide correct input"),r=!1):(o=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,b||T(e.canvas.width,e.canvas.height)),P(),D(),S&&(k(),I(),d>=0&&E()),z(),""!==x&&M(),A(),S||I(),L(),S=!1}catch(e){r=!1}return r},f.download=function(e){if(null===a||0==F)console.log("Please call start method and add frames and call finish method before calling download");else{e=void 0!==e?e.endsWith(".gif")?e:e+".gif":"download.gif";var t=document.createElement("a");t.download=e,t.href=URL.createObjectURL(new Blob([new Uint8Array(a.bin)],{type:"image/gif"})),t.click()}},f.finish=function(){if(!w)return!1;var e=!0;w=!1;try{a.writeByte(59),F=!0}catch(t){e=!1}return e},function(){s=0,o=null,c=null,l=null,h=null,F=!1,S=!0}),T=(f.setFrameRate=function(e){15!=e&&(y=Math.round(100/e))},f.setQuality=function(e){e<1&&(e=1),B=e},f.setSize=function(e,t){w&&!S||((i=e)<1&&(i=320),(n=t)<1&&(n=240),b=!0)}),D=(f.start=function(){N();var e=!0;F=!1,a=new r;try{a.writeUTFBytes("GIF89a")}catch(t){e=!1}return w=e},f.cont=function(){N();return F=!1,a=new r,w=!0},function(){var e=c.length,t=e/3;l=[];var r=new NeuQuant(c,e,B);h=r.process();for(var i=0,n=0;n<t;n++){var a=r.map(255&c[i++],255&c[i++],255&c[i++]);g[a]=!0,l[n]=a}c=null,u=8,p=7,null!==m&&(s=C(m))}),C=function(e){if(null===h)return-1;for(var t=(16711680&e)>>16,r=(65280&e)>>8,i=255&e,n=0,s=16777216,a=h.length,o=0;o<a;){var c=t-(255&h[o++]),l=r-(255&h[o++]),u=i-(255&h[o]),f=c*c+l*l+u*u,m=o/3;g[m]&&f<s&&(s=f,n=m),o++}return n},P=function(){var e=i,t=n;c=[];for(var r=o,s=0,a=0;a<t;a++)for(var l=0;l<e;l++){var u=a*e*4+4*l;c[s++]=r[u],c[s++]=r[u+1],c[s++]=r[u+2]}},z=function(){var e,t;a.writeByte(33),a.writeByte(249),a.writeByte(4),null===m?(e=0,t=0):(e=1,t=2),v>=0&&(t=7&v),t<<=2,a.writeByte(0|t|e),O(y),a.writeByte(s),a.writeByte(0)},M=function(){a.writeByte(33),a.writeByte(254),a.writeByte(x.length),a.writeUTFBytes(x),a.writeByte(0)},A=function(){a.writeByte(44),O(0),O(0),O(i),O(n),S?a.writeByte(0):a.writeByte(128|p)},k=function(){O(i),O(n),a.writeByte(240|p),a.writeByte(0),a.writeByte(0)},E=function(){a.writeByte(33),a.writeByte(255),a.writeByte(11),a.writeUTFBytes("NETSCAPE2.0"),a.writeByte(3),a.writeByte(1),O(d),a.writeByte(0)},I=function(){a.writeBytes(h);for(var e=768-h.length,t=0;t<e;t++)a.writeByte(0)},O=function(e){a.writeByte(255&e),a.writeByte(e>>8&255)},L=function(){new LZWEncoder(i,n,l,u).encode(a)};f.stream=function(){return a},f.setProperties=function(e,t){w=e,S=t};return f}},function(e,t,r){"use strict";r.r(t);r(0),r(1),r(2);const i=[{scale:32,size:"32x32",id:"32"},{scale:64,size:"64x64",id:"64"},{scale:128,size:"128x128",id:"128"}],n=[{size:1,style:"px1"},{size:2,style:"px2"},{size:3,style:"px3"},{size:4,style:"px4"}],s={name:"pen",icon:"fas fa-pen",id:"pen",key:"Pen tool (p)"},a={name:"bucket",icon:"fas fa-fill",id:"bucket",key:"Bucket tool (b)"},o={name:"eraser",icon:"fas fa-eraser",id:"eraser",key:"Eraser tool (e)"},c={name:"stroke",icon:"fas fa-pencil-ruler",id:"stroke",key:"Stroke tool (s)"};new Vue({el:"#app",data(){return{currentTool:null,tools:[{func:this.penTool,...s},{func:this.bucketTool,...a},{func:this.eraserTool,...o},{func:this.strokeTool,...c}],penSizes:n,currentPenSize:null,currentScale:null,primaryColor:"#000000",secondaryColor:"#FF0000",drawingColor:"#000000",scales:i,frames:[],counter:0,currentFrameNumber:0,isDrawing:!1,isLineDrawing:!1,lineStartX0:0,lineStartY0:0,lastX:0,lastY:0,canvas:null,ctx:null,fps:12,currentAnimationFrame:0,animationTimerId:null}},mounted(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d");const e=JSON.parse(localStorage.getItem("data"));if(e)this.currentTool=this.tools.find(t=>t.id===e.currentTool.id),this.currentPenSize=e.currentPenSize,this.currentScale=this.scales.find(t=>t.id===e.currentScale.id),this.primaryColor=e.primaryColor,this.secondaryColor=e.secondaryColor,this.frames=e.frames,Vue.nextTick(()=>{for(let e=0;e<this.frames.length;e+=1)this.currentFrameNumber=e,this.drawOnFrame(e)}),this.counter=e.counter,this.currentFrameNumber=e.currentFrameNumber,this.fps=e.fps;else{this.currentTool=this.tools[0],this.currentScale=this.scales[0],this.currentPenSize=this.penSizes[0].size;let e=this.generateMatrix(this.currentScale.scale);this.frames.push({source:e,id:this.counter})}this.redraw(this.ctx,this.canvas),this.animate(),this.initializeKeyboardShortcuts()},methods:{initializeKeyboardShortcuts(){const e=this;document.addEventListener("keydown",t=>{t.preventDefault();const r=e.currentFrameNumber;"KeyP"===t.code?e.selectTool(e.tools[0]):"KeyB"===t.code?e.selectTool(e.tools[1]):"KeyE"===t.code?e.selectTool(e.tools[2]):"KeyS"===t.code&&t.ctrlKey?e.save():"KeyS"===t.code?e.selectTool(e.tools[3]):"ArrowUp"===t.code?e.selectFrame(r>0?r-1:r):"ArrowDown"===t.code?e.selectFrame(r<e.frames.length-1?r+1:r):"KeyN"===t.code&&t.shiftKey?e.copyFrame(r):"KeyN"===t.code?e.addNewFrame():"Delete"===t.code&&e.deleteFrame(r)})},selectTool(e){this.currentTool=e,this.saveData()},selectScale(e){this.currentScale=e,this.frames[this.currentFrameNumber].source=this.generateMatrix(this.currentScale.scale),this.redraw(this.ctx,this.canvas),this.saveData()},selectPenSize(e){this.currentPenSize=e,this.saveData()},generateMatrix:e=>Array.from({length:e}).fill().map(()=>Array.from({length:e},()=>"#FFF")),redraw(e,t){let r=e;const i=t.width/this.currentScale.scale;for(let e=0;e<this.frames[this.currentFrameNumber].source.length;e+=1)for(let t=0;t<this.frames[this.currentFrameNumber].source[e].length;t+=1)r.fillStyle=this.frames[this.currentFrameNumber].source[e][t],r.fillRect(t*i,e*i,i,i)},penTool(e,t){this.drawLine(this.lastX,this.lastY,e,t)},eraserTool(e,t){const r=Math.floor(e/this.canvas.width*this.currentScale.scale),i=Math.floor(t/this.canvas.width*this.currentScale.scale),n=this.canvas.width/this.currentScale.scale,s=this.frames[this.currentFrameNumber].source.length-1;for(let e=i;e<=Math.min(i+this.currentPenSize,s);e+=1)for(let t=r;t<=Math.min(r+this.currentPenSize,s);t+=1)this.frames[this.currentFrameNumber].source[e][t]="#FFF";this.ctx.fillStyle="#FFF";const a=n*this.currentPenSize;this.ctx.fillRect(r*n,i*n,a,a)},drawPixel(e,t){const r=this.canvas.width/this.currentScale.scale,i=this.frames[this.currentFrameNumber].source.length-1;for(let r=t;r<=Math.min(t+this.currentPenSize-1,i);r+=1)for(let t=e;t<=Math.min(e+this.currentPenSize-1,i);t+=1)this.frames[this.currentFrameNumber].source[r][t]=this.drawingColor;this.ctx.fillStyle=this.frames[this.currentFrameNumber].source[t][e];const n=r*this.currentPenSize;this.ctx.fillRect(e*r,t*r,n,n)},drawLine(e,t,r,i){let n=Math.floor(e/this.canvas.width*this.currentScale.scale),s=Math.floor(t/this.canvas.width*this.currentScale.scale),a=Math.floor(r/this.canvas.width*this.currentScale.scale),o=Math.floor(i/this.canvas.width*this.currentScale.scale),c=Math.abs(a-n),l=Math.abs(o-s),u=n<a?1:-1,h=s<o?1:-1,f=c-l;for(;n!==a||s!==o;){this.drawPixel(n,s);let e=2*f;e>-l&&(f-=l,n+=u),e<c&&(f+=c,s+=h)}this.drawPixel(a,o)},strokeTool(e,t){this.isLineDrawing||(this.lineStartX0=e,this.lineStartY0=t,this.isLineDrawing=!0)},onMouseDown(e){this.isDrawing=!0,2===e.button?this.drawingColor=this.secondaryColor:this.drawingColor=this.primaryColor,this.lastX=e.offsetX,this.lastY=e.offsetY,this.currentTool.func(this.lastX,this.lastY)},onMouseMove(e){this.isDrawing&&!this.isLineDrawing&&(this.currentTool.func(e.offsetX,e.offsetY),this.lastX=e.offsetX,this.lastY=e.offsetY)},onMouseUp(e){this.isLineDrawing&&(this.drawLine(this.lineStartX0,this.lineStartY0,e.offsetX,e.offsetY),this.isLineDrawing=!1),(this.isLineDrawing||this.isDrawing)&&this.drawOnFrame(this.currentFrameNumber),this.isDrawing=!1,this.saveData()},cancelContextMenu(e){e.preventDefault()},bucketTool(){for(let e=0;e<this.frames[this.currentFrameNumber].source.length;e+=1)for(let t=0;t<this.frames[this.currentFrameNumber].source[e].length;t+=1)this.frames[this.currentFrameNumber].source[t][e]=this.drawingColor;this.ctx.fillStyle=this.drawingColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.width)},drawOnFrame(e){let t=document.querySelector(`.frame:nth-child(${e+1}) canvas`),r=t.getContext("2d");this.redraw(r,t)},addNewFrame(){let e=this.generateMatrix(this.currentScale.scale);this.counter+=1,this.frames.push({source:e,id:this.counter}),this.selectFrame(this.frames.length-1),this.saveData()},selectFrame(e){this.currentFrameNumber=e,this.redraw(this.ctx,this.canvas),this.saveData()},deleteFrame(e){1!==this.frames.length&&(this.frames.splice(e,1),e===this.currentFrameNumber?this.selectFrame(0):e<this.currentFrameNumber&&this.selectFrame(this.currentFrameNumber-1),this.saveData())},copyFrame(e){let t=JSON.parse(JSON.stringify(this.frames[e].source));this.counter+=1,this.frames.push({source:t,id:this.counter}),this.selectFrame(this.frames.length-1),Vue.nextTick(()=>this.drawOnFrame(this.frames.length-1)),this.saveData()},drawForAnimation(){let e=document.getElementById("animation"),t=e.getContext("2d");const r=e.width/this.currentScale.scale;for(let e=0;e<this.frames[this.currentAnimationFrame].source.length;e+=1)for(let i=0;i<this.frames[this.currentAnimationFrame].source[e].length;i+=1)t.fillStyle=this.frames[this.currentAnimationFrame].source[e][i],t.fillRect(i*r,e*r,r,r)},animate(){let e=this;e.animationTimerId=setInterval(()=>{e.currentAnimationFrame+1>=e.frames.length?e.currentAnimationFrame=0:e.currentAnimationFrame+=1,e.drawForAnimation()},1e3/e.fps)},save(){let e=document.getElementById("saveCanvas"),t=e.getContext("2d"),r=new GIFEncoder;r.setRepeat(0),r.setDelay(1e3/this.fps),r.start();for(let i=0;i<this.frames.length;i+=1){const n=e.width/this.currentScale.scale;for(let e=0;e<this.frames[i].source.length;e+=1)for(let r=0;r<this.frames[i].source[e].length;r+=1)t.fillStyle=this.frames[i].source[e][r],t.fillRect(r*n,e*n,n,n);r.addFrame(t)}r.finish(),r.download("animation.gif")},saveData(){const e={currentTool:this.currentTool,currentPenSize:this.currentPenSize,currentScale:this.currentScale,primaryColor:this.primaryColor,secondaryColor:this.secondaryColor,frames:this.frames,counter:this.counter,currentFrameNumber:this.currentFrameNumber,fps:this.fps};localStorage.setItem("data",JSON.stringify(e))},toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.getElementById("animation").requestFullscreen()},reset(){this.primaryColor="#000000",this.secondaryColor="#FF0000",this.frames=[],this.currentFrameNumber=0,this.fps=12;const e=this.generateMatrix(this.currentScale.scale);this.frames.push({source:e,id:this.counter}),this.redraw(this.ctx,this.canvas),Vue.nextTick(()=>{this.drawOnFrame(0)})}},watch:{fps(){clearInterval(this.animationTimerId),this.animate()}}})}]);