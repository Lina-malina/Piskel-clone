!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);r(1),r(2),r(3);new Vue({el:"#app",data(){return{currentTool:null,tools:[{name:"pen",icon:"fas fa-pen",id:"pen",func:this.penTool,key:"Pen tool (p)"},{name:"bucket",icon:"fas fa-fill",id:"bucket",func:this.bucketTool,key:"Bucket tool (b)"},{name:"eraser",icon:"fas fa-eraser",id:"eraser",func:this.eraserTool,key:"Eraser tool (e)"},{name:"stroke",icon:"fas fa-pencil-ruler",id:"stroke",func:this.strokeTool,key:"Stroke tool (s)"}],penSizes:[{size:1,style:"px1"},{size:2,style:"px2"},{size:3,style:"px3"},{size:4,style:"px4"}],currentPenSize:null,currentScale:null,primaryColor:"#000000",secondaryColor:"#FF0000",drawingColor:"#000000",scales:[{scale:32,size:"32x32",id:"32"},{scale:64,size:"64x64",id:"64"},{scale:128,size:"128x128",id:"128"}],frames:[],counter:0,currentFrameNumber:0,isDrawing:!1,isLineDrawing:!1,lineStartX0:0,lineStartY0:0,lastX:0,lastY:0,canvas:null,ctx:null,fps:12,currentAnimationFrame:0,animationTimerId:null}},mounted(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d");const e=JSON.parse(localStorage.getItem("data"));if(e)this.currentTool=this.tools.find(t=>t.id===e.currentTool.id),this.currentPenSize=e.currentPenSize,this.currentScale=this.scales.find(t=>t.id===e.currentScale.id),this.primaryColor=e.primaryColor,this.secondaryColor=e.secondaryColor,this.frames=e.frames,Vue.nextTick(()=>{for(let e=0;e<this.frames.length;e+=1)this.currentFrameNumber=e,this.drawOnFrame(e)}),this.counter=e.counter,this.currentFrameNumber=e.currentFrameNumber,this.fps=e.fps;else{this.currentTool=this.tools[0],this.currentScale=this.scales[0],this.currentPenSize=this.penSizes[0].size;let e=this.generateMatrix(this.currentScale.scale);this.frames.push({source:e,id:this.counter})}this.redraw(this.ctx,this.canvas),this.animate();const t=this;document.addEventListener("keydown",e=>{e.preventDefault();const r=t.currentFrameNumber;"KeyP"===e.code?t.selectTool(t.tools[0]):"KeyB"===e.code?t.selectTool(t.tools[1]):"KeyE"===e.code?t.selectTool(t.tools[2]):"KeyS"===e.code&&e.ctrlKey?t.save():"KeyS"===e.code?t.selectTool(t.tools[3]):"ArrowUp"===e.code?t.selectFrame(r>0?r-1:r):"ArrowDown"===e.code?t.selectFrame(r<t.frames.length-1?r+1:r):"KeyN"===e.code&&e.shiftKey?t.copyFrame(r):"KeyN"===e.code?t.addNewFrame():"Delete"===e.code&&t.deleteFrame(r)})},methods:{selectTool(e){this.currentTool=e,this.saveData()},selectScale(e){this.currentScale=e,this.frames[this.currentFrameNumber].source=this.generateMatrix(this.currentScale.scale),this.redraw(this.ctx,this.canvas),this.saveData()},selectPenSize(e){this.currentPenSize=e,this.saveData()},generateMatrix:e=>Array.from({length:e}).fill().map(()=>Array.from({length:e},()=>"#FFF")),redraw(e,t){let r=e;const n=t.width/this.currentScale.scale;for(let e=0;e<this.frames[this.currentFrameNumber].source.length;e+=1)for(let t=0;t<this.frames[this.currentFrameNumber].source[e].length;t+=1)r.fillStyle=this.frames[this.currentFrameNumber].source[e][t],r.fillRect(t*n,e*n,n,n)},penTool(e,t){this.drawLine(this.lastX,this.lastY,e,t)},eraserTool(e,t){const r=Math.floor(e/this.canvas.width*this.currentScale.scale),n=Math.floor(t/this.canvas.width*this.currentScale.scale),i=this.canvas.width/this.currentScale.scale,s=this.frames[this.currentFrameNumber].source.length-1;for(let e=n;e<=Math.min(n+this.currentPenSize,s);e+=1)for(let t=r;t<=Math.min(r+this.currentPenSize,s);t+=1)this.frames[this.currentFrameNumber].source[e][t]="#FFF";this.ctx.fillStyle="#FFF";const a=i*this.currentPenSize;this.ctx.fillRect(r*i,n*i,a,a)},drawPixel(e,t){const r=this.canvas.width/this.currentScale.scale,n=this.frames[this.currentFrameNumber].source.length-1;for(let r=t;r<=Math.min(t+this.currentPenSize,n);r+=1)for(let t=e;t<=Math.min(e+this.currentPenSize,n);t+=1)this.frames[this.currentFrameNumber].source[r][t]=this.drawingColor;this.ctx.fillStyle=this.frames[this.currentFrameNumber].source[t][e];const i=r*this.currentPenSize;this.ctx.fillRect(e*r,t*r,i,i)},drawLine(e,t,r,n){let i=Math.floor(e/this.canvas.width*this.currentScale.scale),s=Math.floor(t/this.canvas.width*this.currentScale.scale),a=Math.floor(r/this.canvas.width*this.currentScale.scale),o=Math.floor(n/this.canvas.width*this.currentScale.scale),c=Math.abs(a-i),l=Math.abs(o-s),u=i<a?1:-1,h=s<o?1:-1,f=c-l;for(;i!==a||s!==o;){this.drawPixel(i,s);let e=2*f;e>-l&&(f-=l,i+=u),e<c&&(f+=c,s+=h)}this.drawPixel(a,o)},strokeTool(e,t){this.isLineDrawing||(this.lineStartX0=e,this.lineStartY0=t,this.isLineDrawing=!0)},onMouseDown(e){this.isDrawing=!0,2===e.button?this.drawingColor=this.secondaryColor:this.drawingColor=this.primaryColor,this.lastX=e.offsetX,this.lastY=e.offsetY,this.currentTool.func(this.lastX,this.lastY)},onMouseMove(e){this.isDrawing&&!this.isLineDrawing&&(this.currentTool.func(e.offsetX,e.offsetY),this.lastX=e.offsetX,this.lastY=e.offsetY)},onMouseUp(e){this.isLineDrawing&&(this.drawLine(this.lineStartX0,this.lineStartY0,e.offsetX,e.offsetY),this.isLineDrawing=!1),(this.isLineDrawing||this.isDrawing)&&this.drawOnFrame(this.currentFrameNumber),this.isDrawing=!1,this.saveData()},cancelContextMenu(e){e.preventDefault()},bucketTool(){for(let e=0;e<this.frames[this.currentFrameNumber].source.length;e+=1)for(let t=0;t<this.frames[this.currentFrameNumber].source[e].length;t+=1)this.frames[this.currentFrameNumber].source[t][e]=this.drawingColor;this.ctx.fillStyle=this.drawingColor,this.ctx.fillRect(0,0,512,512)},drawOnFrame(e){let t=document.querySelector(`.frame:nth-child(${e+1}) canvas`),r=t.getContext("2d");this.redraw(r,t)},addNewFrame(){let e=this.generateMatrix(this.currentScale.scale);this.counter+=1,this.frames.push({source:e,id:this.counter}),this.selectFrame(this.frames.length-1),this.saveData()},selectFrame(e){this.currentFrameNumber=e,this.redraw(this.ctx,this.canvas),this.saveData()},deleteFrame(e){1!==this.frames.length&&(this.frames.splice(e,1),e===this.currentFrameNumber?this.selectFrame(0):e<this.currentFrameNumber&&this.selectFrame(this.currentFrameNumber-1),this.saveData())},copyFrame(e){let t=JSON.parse(JSON.stringify(this.frames[e].source));this.counter+=1,this.frames.push({source:t,id:this.counter}),this.selectFrame(this.frames.length-1),Vue.nextTick(()=>this.drawOnFrame(this.frames.length-1)),this.saveData()},drawForAnimation(){let e=document.getElementById("animation"),t=e.getContext("2d");const r=e.width/this.currentScale.scale;for(let e=0;e<this.frames[this.currentAnimationFrame].source.length;e+=1)for(let n=0;n<this.frames[this.currentAnimationFrame].source[e].length;n+=1)t.fillStyle=this.frames[this.currentAnimationFrame].source[e][n],t.fillRect(n*r,e*r,r,r)},animate(){let e=this;e.animationTimerId=setInterval(()=>{e.currentAnimationFrame+1>=e.frames.length?e.currentAnimationFrame=0:e.currentAnimationFrame+=1,e.drawForAnimation()},1e3/e.fps)},save(){let e=document.getElementById("saveCanvas"),t=e.getContext("2d"),r=new GIFEncoder;r.setRepeat(0),r.setDelay(1e3/this.fps),r.start();for(let n=0;n<this.frames.length;n+=1){const i=e.width/this.currentScale.scale;for(let e=0;e<this.frames[n].source.length;e+=1)for(let r=0;r<this.frames[n].source[e].length;r+=1)t.fillStyle=this.frames[n].source[e][r],t.fillRect(r*i,e*i,i,i);r.addFrame(t)}r.finish(),r.download("yourAwesome.gif")},saveData(){const e={currentTool:this.currentTool,currentPenSize:this.currentPenSize,currentScale:this.currentScale,primaryColor:this.primaryColor,secondaryColor:this.secondaryColor,frames:this.frames,counter:this.counter,currentFrameNumber:this.currentFrameNumber,fps:this.fps};localStorage.setItem("data",JSON.stringify(e))},toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.getElementById("animation").requestFullscreen()}},watch:{fps(){clearInterval(this.animationTimerId),this.animate()}}})},function(e,t){NeuQuant=function(){var e,t,r,n,i,s={},a=256,o=499,c=491,l=487,u=503,h=3*u,f=a-1,m=4,d=100,y=16,w=1<<y,g=10,p=10,v=w>>p,F=w<<g-p,S=a>>3,b=6,B=1<<b,x=S*B,N=30,T=10,D=1<<T,C=8,P=1<<C,M=T+C,z=1<<M,A=[],k=[],E=[],I=[],L=s.NeuQuant=function(e,s,o){var c,l;for(t=e,r=s,n=o,i=new Array(a),c=0;c<a;c++)i[c]=new Array(4),(l=i[c])[0]=l[1]=l[2]=(c<<m+8)/a,E[c]=w/a,k[c]=0},O=function(){for(var e=[],t=new Array(a),r=0;r<a;r++)t[i[r][3]]=r;for(var n=0,s=0;s<a;s++){var o=t[s];e[n++]=i[o][0],e[n++]=i[o][1],e[n++]=i[o][2]}return e},X=function(){var e,t,r,n,s,o,c,l;for(c=0,l=0,e=0;e<a;e++){for(r=e,n=(s=i[e])[1],t=e+1;t<a;t++)(o=i[t])[1]<n&&(r=t,n=o[1]);if(o=i[r],e!=r&&(t=o[0],o[0]=s[0],s[0]=t,t=o[1],o[1]=s[1],s[1]=t,t=o[2],o[2]=s[2],s[2]=t,t=o[3],o[3]=s[3],s[3]=t),n!=c){for(A[c]=l+e>>1,t=c+1;t<n;t++)A[t]=e;c=n,l=e}}for(A[c]=l+f>>1,t=c+1;t<256;t++)A[t]=f},Y=function(){var i,s,a,f,y,w,g,p,v,F,S,B,T,C;for(r<h&&(n=1),e=30+(n-1)/3,B=t,T=0,C=r,F=(S=r/(3*n))/d|0,p=D,(g=(w=x)>>b)<=1&&(g=0),i=0;i<g;i++)I[i]=p*((g*g-i*i)*P/(g*g));for(v=r<h?3:r%o!=0?3*o:r%c!=0?3*c:r%l!=0?3*l:3*u,i=0;i<S;)if(a=(255&B[T+0])<<m,f=(255&B[T+1])<<m,y=(255&B[T+2])<<m,s=K(a,f,y),U(p,s,a,f,y),0!==g&&j(g,s,a,f,y),(T+=v)>=C&&(T-=r),0===F&&(F=1),++i%F==0)for(p-=p/e,(g=(w-=w/N)>>b)<=1&&(g=0),s=0;s<g;s++)I[s]=p*((g*g-s*s)*P/(g*g))},R=(s.map=function(e,t,r){var n,s,o,c,l,u,h;for(l=1e3,h=-1,s=(n=A[t])-1;n<a||s>=0;)n<a&&((o=(u=i[n])[1]-t)>=l?n=a:(n++,o<0&&(o=-o),(c=u[0]-e)<0&&(c=-c),(o+=c)<l&&((c=u[2]-r)<0&&(c=-c),(o+=c)<l&&(l=o,h=u[3])))),s>=0&&((o=t-(u=i[s])[1])>=l?s=-1:(s--,o<0&&(o=-o),(c=u[0]-e)<0&&(c=-c),(o+=c)<l&&((c=u[2]-r)<0&&(c=-c),(o+=c)<l&&(l=o,h=u[3]))));return h},s.process=function(){return Y(),R(),X(),O()},function(){var e;for(e=0;e<a;e++)i[e][0]>>=m,i[e][1]>>=m,i[e][2]>>=m,i[e][3]=e}),j=function(e,t,r,n,s){var o,c,l,u,h,f,m;for((l=t-e)<-1&&(l=-1),(u=t+e)>a&&(u=a),o=t+1,c=t-1,f=1;o<u||c>l;){if(h=I[f++],o<u){m=i[o++];try{m[0]-=h*(m[0]-r)/z,m[1]-=h*(m[1]-n)/z,m[2]-=h*(m[2]-s)/z}catch(e){}}if(c>l){m=i[c--];try{m[0]-=h*(m[0]-r)/z,m[1]-=h*(m[1]-n)/z,m[2]-=h*(m[2]-s)/z}catch(e){}}}},U=function(e,t,r,n,s){var a=i[t];a[0]-=e*(a[0]-r)/D,a[1]-=e*(a[1]-n)/D,a[2]-=e*(a[2]-s)/D},K=function(e,t,r){var n,s,o,c,l,u,h,f,d,w;for(d=f=~(1<<31),h=u=-1,n=0;n<a;n++)(s=(w=i[n])[0]-e)<0&&(s=-s),(o=w[1]-t)<0&&(o=-o),s+=o,(o=w[2]-r)<0&&(o=-o),(s+=o)<f&&(f=s,u=n),(c=s-(k[n]>>y-m))<d&&(d=c,h=n),l=E[n]>>p,E[n]-=l,k[n]+=l<<g;return E[u]+=v,k[u]-=F,h};return L.apply(this,arguments),s}},function(e,t){LZWEncoder=function(){var e,t,r,n,i,s,a,o,c,l,u,h,f={},m=-1,d=12,y=5003,w=d,g=1<<d,p=[],v=[],F=y,S=0,b=!1,B=0,x=0,N=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],T=[],D=f.LZWEncoder=function(i,s,a,o){e=i,t=s,r=a,n=Math.max(2,o)},C=function(e,t){T[h++]=e,h>=254&&A(t)},P=function(e){M(F),S=l+2,b=!0,I(l,e)},M=function(e){for(var t=0;t<e;++t)p[t]=-1},z=f.compress=function(e,t){var r,n,i,s,f,d,y;for(b=!1,o=k(a=c=e),u=(l=1<<e-1)+1,S=l+2,h=0,s=E(),y=0,r=F;r<65536;r*=2)++y;y=8-y,M(d=F),I(l,t);e:for(;(i=E())!=m;)if(r=(i<<w)+s,p[n=i<<y^s]!=r){if(p[n]>=0){f=d-n,0===n&&(f=1);do{if((n-=f)<0&&(n+=d),p[n]==r){s=v[n];continue e}}while(p[n]>=0)}I(s,t),s=i,S<g?(v[n]=S++,p[n]=r):P(t)}else s=v[n];I(s,t),I(u,t)},A=(f.encode=function(r){r.writeByte(n),i=e*t,s=0,z(n+1,r),r.writeByte(0)},function(e){h>0&&(e.writeByte(h),e.writeBytes(T,0,h),h=0)}),k=function(e){return(1<<e)-1},E=function(){return 0===i?m:(--i,255&r[s++])},I=function(e,t){for(B&=N[x],x>0?B|=e<<x:B=e,x+=a;x>=8;)C(255&B,t),B>>=8,x-=8;if((S>o||b)&&(b?(o=k(a=c),b=!1):(++a,o=a==w?g:k(a))),e==u){for(;x>0;)C(255&B,t),B>>=8,x-=8;A(t)}};return D.apply(this,arguments),f}},function(e,t){GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,n=0;n<r;n++)e+=t[this.bin[n]];return e},r.prototype.writeByte=function(e){this.bin.push(e)},r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))},r.prototype.writeBytes=function(e,t,r){for(var n=r||e.length,i=t||0;i<n;i++)this.writeByte(e[i])};var n,i,s,a,o,c,l,u,h,f={},m=null,d=-1,y=0,w=!1,g=[],p=7,v=-1,F=!1,S=!0,b=!1,B=10,x="Generated by jsgif (https://github.com/antimatter15/jsgif/)",N=(f.setDelay=function(e){y=Math.round(e/10)},f.setDispose=function(e){e>=0&&(v=e)},f.setRepeat=function(e){e>=0&&(d=e)},f.setTransparent=function(e){m=e},f.setComment=function(e){x=e},f.addFrame=function(e,t){if(null===e||!w||null===a)throw new Error("Please call start method before calling addFrame");var r=!0;try{t?e instanceof ImageData?(o=e.data,sizeset&&n==e.width&&i==e.height||T(e.width,e.height)):e instanceof Uint8ClampedArray?e.length==n*i*4?o=e:(console.log("Please set the correct size: ImageData length mismatch"),r=!1):(console.log("Please provide correct input"),r=!1):(o=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,b||T(e.canvas.width,e.canvas.height)),P(),D(),S&&(k(),I(),d>=0&&E()),M(),""!==x&&z(),A(),S||I(),O(),S=!1}catch(e){r=!1}return r},f.download=function(e){if(null===a||0==F)console.log("Please call start method and add frames and call finish method before calling download");else{e=void 0!==e?e.endsWith(".gif")?e:e+".gif":"download.gif";var t=document.createElement("a");t.download=e,t.href=URL.createObjectURL(new Blob([new Uint8Array(a.bin)],{type:"image/gif"})),t.click()}},f.finish=function(){if(!w)return!1;var e=!0;w=!1;try{a.writeByte(59),F=!0}catch(t){e=!1}return e},function(){s=0,o=null,c=null,l=null,h=null,F=!1,S=!0}),T=(f.setFrameRate=function(e){15!=e&&(y=Math.round(100/e))},f.setQuality=function(e){e<1&&(e=1),B=e},f.setSize=function(e,t){w&&!S||((n=e)<1&&(n=320),(i=t)<1&&(i=240),b=!0)}),D=(f.start=function(){N();var e=!0;F=!1,a=new r;try{a.writeUTFBytes("GIF89a")}catch(t){e=!1}return w=e},f.cont=function(){N();return F=!1,a=new r,w=!0},function(){var e=c.length,t=e/3;l=[];var r=new NeuQuant(c,e,B);h=r.process();for(var n=0,i=0;i<t;i++){var a=r.map(255&c[n++],255&c[n++],255&c[n++]);g[a]=!0,l[i]=a}c=null,u=8,p=7,null!==m&&(s=C(m))}),C=function(e){if(null===h)return-1;for(var t=(16711680&e)>>16,r=(65280&e)>>8,n=255&e,i=0,s=16777216,a=h.length,o=0;o<a;){var c=t-(255&h[o++]),l=r-(255&h[o++]),u=n-(255&h[o]),f=c*c+l*l+u*u,m=o/3;g[m]&&f<s&&(s=f,i=m),o++}return i},P=function(){var e=n,t=i;c=[];for(var r=o,s=0,a=0;a<t;a++)for(var l=0;l<e;l++){var u=a*e*4+4*l;c[s++]=r[u],c[s++]=r[u+1],c[s++]=r[u+2]}},M=function(){var e,t;a.writeByte(33),a.writeByte(249),a.writeByte(4),null===m?(e=0,t=0):(e=1,t=2),v>=0&&(t=7&v),t<<=2,a.writeByte(0|t|e),L(y),a.writeByte(s),a.writeByte(0)},z=function(){a.writeByte(33),a.writeByte(254),a.writeByte(x.length),a.writeUTFBytes(x),a.writeByte(0)},A=function(){a.writeByte(44),L(0),L(0),L(n),L(i),S?a.writeByte(0):a.writeByte(128|p)},k=function(){L(n),L(i),a.writeByte(240|p),a.writeByte(0),a.writeByte(0)},E=function(){a.writeByte(33),a.writeByte(255),a.writeByte(11),a.writeUTFBytes("NETSCAPE2.0"),a.writeByte(3),a.writeByte(1),L(d),a.writeByte(0)},I=function(){a.writeBytes(h);for(var e=768-h.length,t=0;t<e;t++)a.writeByte(0)},L=function(e){a.writeByte(255&e),a.writeByte(e>>8&255)},O=function(){new LZWEncoder(n,i,l,u).encode(a)};f.stream=function(){return a},f.setProperties=function(e,t){w=e,S=t};return f}}]);